<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">  

  <style>
    :root{
      --blue-main:#0f5fff;
      --blue-dark:#021739;
      --glass:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.18);
      --text:#ffffff;
      --muted:rgba(233,237,255,.7);
      --shadow:0 12px 38px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Cairo',system-ui,Segoe UI,Arial,sans-serif;
      background:
        radial-gradient(1200px 400px at 100% -10%, rgba(15,95,255,.9) 0%, rgba(15,95,255,0) 60%),
        radial-gradient(900px 420px at 0% 120%, rgba(13,63,168,.95) 0%, rgba(1,13,37,0) 60%),
        linear-gradient(160deg, #021739 0%, #041d4b 50%, #021739 100%);
      min-height:100vh;
      color:var(--text);
      overflow-x:hidden;
    }
    .bg-grid{
      position:fixed;inset:0;pointer-events:none;z-index:-3;
      background-image:
        linear-gradient(transparent 95%, rgba(255,255,255,.035) 95%),
        linear-gradient(90deg, transparent 95%, rgba(255,255,255,.035) 95%);
      background-size:60px 60px,60px 60px;
      opacity:.6;
      animation:grid 38s linear infinite;
    }
    @keyframes grid{
      0%{background-position:0 0,0 0}
      100%{background-position:600px 600px,600px 600px}
    }
    .orb{
      position:fixed;border-radius:50%;filter:blur(28px);opacity:.32;z-index:-2;
      background:radial-gradient(circle,#0f5fff 0%,rgba(2,23,57,0) 70%);
      animation:float 20s ease-in-out infinite;
    }
    .orb.o1{width:340px;height:340px;top:-50px;right:-80px}
    .orb.o2{width:240px;height:240px;bottom:-50px;left:-50px}
    @keyframes float{
      0%{transform:translate(0,0)}
      50%{transform:translate(20px,-15px)}
      100%{transform:translate(0,0)}
    }

    .container{
      width:min(1220px,100%);
      margin:0 auto;
      padding:14px 14px 90px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .header{
      background:rgba(255,255,255,.04);
      border:1px solid var(--stroke);
      backdrop-filter:blur(18px);
      border-radius:16px;
      padding:14px 14px 10px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      box-shadow:0 10px 35px rgba(0,0,0,.25);
    }
    .title{
      font-size:1.05rem;
      font-weight:800;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .badges{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .badge{
      background:rgba(255,255,255,.02);
      border:1px solid rgba(255,255,255,.25);
      border-radius:14px;
      padding:5px 9px;
      font-size:.66rem;
      display:flex;
      align-items:center;
      gap:6px;
      color:#fff;
    }

    .malls-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(225px,1fr));
      gap:12px;
    }
    .mall-card{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter:blur(12px);
      border-radius:15px;
      padding:15px 14px 14px;
      text-align:center;
      box-shadow:0 10px 32px rgba(0,0,0,.25);
      cursor:pointer;
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .mall-card:active{transform:scale(.993)}
    .mall-card:hover{box-shadow:0 13px 35px rgba(1,7,30,.3)}
    .icon-3d{
      width:48px;
      height:48px;
      margin:0 auto 6px;
      border-radius:18px;
      background:linear-gradient(140deg,#fff 0%,#d5e2ff 35%,#9db7ff 100%);
      box-shadow:0 8px 16px rgba(10,20,50,.32), inset 0 -3px 6px rgba(255,255,255,.45);
      display:grid;
      place-items:center;
      font-size:1.4rem;
    }
    .icon-3d.orange{
      background:linear-gradient(140deg,#fff 0%,#ffe2d0 35%,#ff9d5c 100%);
      box-shadow:0 8px 16px rgba(62,31,11,.25), inset 0 -3px 6px rgba(255,255,255,.55);
    }
    .icon-3d.green{
      background:linear-gradient(140deg,#fff 0%,#d8ffe8 35%,#63dda3 100%);
      box-shadow:0 8px 16px rgba(11,54,39,.25), inset 0 -3px 6px rgba(255,255,255,.55);
    }
    .mall-card h2{
      font-size:.78rem;
      margin-bottom:3px;
      font-weight:700;
      color:#fff;
    }
    .mall-card h1{
      font-size:1.6rem;
      font-weight:800;
      letter-spacing:-.02em;
      color:#fff;
    }
    .mall-card h1 small{font-size:.7rem;opacity:.7}
    .performance-status{
      font-size:.63rem;
      margin-top:4px;
    }
    .above-target{color:rgba(197,255,227,.95)}
    .below-target{color:rgba(255,238,231,.85)}

    .section-title{
      font-weight:700;
      font-size:.78rem;
      display:flex;
      gap:6px;
      align-items:center;
      margin-top:6px;
      color:#fff;
    }

    .extras-cards{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
      gap:10px;
    }
    .stat-card{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter:blur(10px);
      border-radius:14px;
      padding:10px 10px 9px;
      display:flex;
      gap:9px;
      align-items:center;
    }
    .stat-icon{
      width:38px;height:38px;border-radius:14px;
      background:linear-gradient(160deg,#fff 0%,#d3e0ff 70%);
      display:grid;place-items:center;
      color:#0f5fff;
      flex:0 0 auto;
      box-shadow:0 8px 15px rgba(0,0,0,.15);
      font-weight:700;
    }
    .stat-title{font-size:.62rem;color:rgba(240,245,255,.85)}
    .stat-value{font-size:1rem;font-weight:800;color:#fff;line-height:1.15}
    .stat-note{font-size:.56rem;color:rgba(224,229,255,.6)}

    .best-dept-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(270px,1fr));
      gap:12px;
    }
    .best-card{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter:blur(10px);
      border-radius:14px;
      padding:10px 10px 9px;
    }
    .best-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom:6px;
    }
    .best-left{display:flex;gap:6px;align-items:center}
    .badge-square{
      width:26px;height:26px;border-radius:12px;
      background:linear-gradient(140deg,#fff 0%,#d6e2ff 100%);
      display:grid;place-items:center;
      color:#0f5fff;
      box-shadow:0 6px 12px rgba(0,0,0,.16);
      font-weight:700;
      font-size:.9rem;
    }
    .chip{
      background:rgba(255,255,255,.02);
      border:1px solid rgba(255,255,255,.25);
      border-radius:999px;
      padding:3px 7px;
      font-size:.56rem;
      color:#fff;
    }
    .dept-list{display:grid;gap:6px}
    .dept-row{
      display:flex;
      gap:8px;
      align-items:center;
      background:rgba(2,6,25,.15);
      border:1px solid rgba(255,255,255,.04);
      border-radius:11px;
      padding:5px 6px;
    }
    .dept-icon-3d{
      width:32px;
      height:32px;
      border-radius:14px;
      background:linear-gradient(140deg,#fff 0%,#d8e2ff 35%,#b7c7ff 100%);
      box-shadow:0 6px 12px rgba(0,0,0,.14), inset 0 -2px 4px rgba(255,255,255,.4);
      display:grid;
      place-items:center;
      font-size:1rem;
      flex:0 0 auto;
    }
    .dept-icon-3d.orange{
      background:linear-gradient(140deg,#fff 0%,#ffe2d4 35%,#ff9960 100%);
    }
    .dept-icon-3d.green{
      background:linear-gradient(140deg,#fff 0%,#e1ffe8 35%,#72dfab 100%);
    }
    .dept-name{font-size:.62rem}
    .dept-row .chip{margin-right:auto}

    .modal-overlay{
      position:fixed;
      inset:0;
      background:rgba(1,6,25,.75);
      backdrop-filter:blur(2px);
      display:none;
      z-index:1000;
      padding:12px;
      overflow:auto;
    }
    .modal{
      max-width:900px;
      margin:30px auto;
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.15);
      backdrop-filter:blur(11px);
      border-radius:16px;
      padding:12px 10px 14px;
      box-shadow:0 10px 38px rgba(0,0,0,.35);
    }
    .hdr{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom:10px;
    }
    .close-btn{
      width:34px;height:34px;border-radius:999px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.14);
      display:grid;place-items:center;
      color:#fff;
      cursor:pointer;
    }
    .departments-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(165px,1fr));
      gap:9px;
    }
    .department-card{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.14);
      border-radius:14px;
      padding:9px 6px;
      text-align:center;
    }
    .dep-icon-holder{
      width:40px;height:40px;margin:0 auto 5px;
      border-radius:14px;
      background:linear-gradient(140deg,#fff 0%,#e2e9ff 50%,#a5b6ff 100%);
      box-shadow:0 6px 12px rgba(0,0,0,.18);
      display:grid;place-items:center;
      font-size:1.2rem;
    }
    .dep-icon-holder.orange{
      background:linear-gradient(140deg,#fff 0%,#ffe3d3 50%,#ff9d5c 100%);
    }
    .dep-icon-holder.green{
      background:linear-gradient(140deg,#fff 0%,#e2ffe7 50%,#66d6a2 100%);
    }
    .department-percentage{font-weight:800;font-size:.9rem;color:#fff}
    .department-performance{font-size:.6rem;margin-top:3px}
    .above{color:rgba(219,255,235,.95)}
    .below{color:rgba(255,232,228,.85)}

    @media (max-width:620px){
      .header{flex-direction:column;align-items:flex-start}
      .container{padding-inline:10px}
      .extras-cards{grid-template-columns:1fr}
      .best-dept-grid{grid-template-columns:1fr}
      .malls-grid{grid-template-columns:1fr}
      .departments-grid{grid-template-columns:1fr 1fr}
    }
    @media (max-width:440px){
      .departments-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="bg-grid"></div>
  <div class="orb o1"></div>
  <div class="orb o2"></div>

  <div class="container">
    <div class="header">
      <div class="title">Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
      <div class="badges">
        <div class="badge" id="currentDate"></div>
        <div class="badge" id="dailyBadge"></div>
        <div class="badge" id="cumBadge"></div>
      </div>
    </div>

    <div class="malls-grid" id="mallsGrid">
      <div class="mall-card" data-mall="ansar">
        <div class="icon-3d"><span>ğŸ™ï¸</span></div>
        <h2>Ø§Ù„Ø£Ù†ØµØ§Ø± Ù…ÙˆÙ„</h2>
        <h1><span class="mall-percentage">15.79</span><small>%</small></h1>
        <div class="performance-status"></div>
      </div>
      <div class="mall-card" data-mall="abyat">
        <div class="icon-3d orange"><span>ğŸ </span></div>
        <h2>Ø£Ø¨ÙŠØ§Øª Ø¹Ø³ÙŠØ±</h2>
        <h1><span class="mall-percentage">10.76</span><small>%</small></h1>
        <div class="performance-status"></div>
      </div>
      <div class="mall-card" data-mall="fourpark">
        <div class="icon-3d green"><span>ğŸ…¿ï¸</span></div>
        <h2>ÙÙˆØ± Ø¨Ø§Ø±Ùƒ</h2>
        <h1><span class="mall-percentage">10.08</span><small>%</small></h1>
        <div class="performance-status"></div>
      </div>
      <div class="mall-card" data-mall="arabplaza">
        <div class="icon-3d"><span>ğŸ¢</span></div>
        <h2>Ø§Ù„Ø¹Ø±Ø¨ Ø¨Ù„Ø§Ø²Ø§</h2>
        <h1><span class="mall-percentage">25.45</span><small>%</small></h1>
        <div class="performance-status"></div>
      </div>
    </div>

    <div class="section-title">Ù…Ø¤Ø´Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</div>
    <div class="extras-cards" id="extraCards"></div>

    <div class="section-title">Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ ÙƒÙ„ Ù…Ø±ÙƒØ²</div>
    <div class="best-dept-grid" id="bestDeptGrid"></div>
  </div>

  <div class="modal-overlay" id="modal">
    <div class="modal">
      <div class="hdr">
        <h3 id="modalTitle" style="font-size:.85rem;font-weight:700">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ²</h3>
        <button class="close-btn" id="closeModal">âœ•</button>
      </div>
      <div class="departments-grid" id="departmentsContainer"></div>
    </div>
  </div>

  <script>
    const mallsData = {
      ansar: {
        title: "Ø§Ù„Ø£Ù†ØµØ§Ø± Ù…ÙˆÙ„",
        departments: [
          { name: "Ø§Ù„Ù…ÙØ±ÙˆØ´Ø§Øª", percentage: 13.10 },
          { name: "Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©", percentage: 21.42 },
          { name: "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ©", percentage: 12.05 },
          { name: "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠØ©", percentage: 17.15 },
          { name: "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„ÙˆÙ„Ø§Ø¯ÙŠ", percentage: 19.98 },
          { name: "Ø§Ù„Ø¹Ø·ÙˆØ±", percentage: 14.66 },
          { name: "Ø§Ù„Ø£Ø­Ø°ÙŠØ©", percentage: 17.15 },
          { name: "Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨", percentage: 10.45 },
          { name: "Ø§Ù„Ø±ÙŠØ§Ø¶Ø© Ùˆ Ø§Ù„Ø¬Ø§ÙƒØª", percentage: 16.85 },
          { name: "Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª", percentage: 19.51 },
          { name: "Ø³ÙŠÙÙˆØ±Ø§", percentage: 18.33 },
          { name: "Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙˆØ§Ù„Ø´Ù†Ø·", percentage: 7.28 }
        ]
      },
      fourpark: {
        title: "ÙÙˆØ± Ø¨Ø§Ø±Ùƒ",
        departments: [
          { name: "Ø§Ù„Ù…ÙØ±ÙˆØ´Ø§Øª", percentage: 9.23 },
          { name: "Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©", percentage: 20.45 }
        ]
      },
      abyat: {
        title: "Ø£Ø¨ÙŠØ§Øª Ø¹Ø³ÙŠØ±",
        departments: [
          { name: "Ø§Ù„Ù…ÙØ±ÙˆØ´Ø§Øª", percentage: 19.47 },
          { name: "Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©", percentage: 20.64 },
          { name: "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ©", percentage: 11.49 },
          { name: "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠØ©", percentage: 7.86 },
          { name: "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„ÙˆÙ„Ø§Ø¯ÙŠ", percentage: 2.43 },
          { name: "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø¨Ù†Ø§ØªÙŠ", percentage: 4.65 },
          { name: "Ø§Ù„Ø£Ø­Ø°ÙŠØ©", percentage: 10.16 },
          { name: "Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨", percentage: 7.14 },
          { name: "Ø§Ù„Ø¹Ø·ÙˆØ±", percentage: 10.11 },
          { name: "Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯", percentage: 6.61 }
        ]
      },
      arabplaza: {
        title: "Ø§Ù„Ø¹Ø±Ø¨ Ø¨Ù„Ø§Ø²Ø§",
        departments: [
          { name: "Ø§Ù„Ù…ÙØ±ÙˆØ´Ø§Øª", percentage: 26.64 },
          { name: "Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©", percentage: 26.20 },
          { name: "Ø£Ù„Ø¹Ø§Ø¨", percentage: 15.14 }
        ]
      }
    };

    function fmt(n, d=2){
      return isFinite(n) ? (+n).toFixed(d) : '';
    }

    function getMonthDays(d=new Date()){
      return new Date(d.getFullYear(), d.getMonth()+1, 0).getDate();
    }

    function getDailyTarget(d=new Date()){
      return +(100 / getMonthDays(d)).toFixed(5);
    }

    function getCumulativeTarget(d=new Date()){
      const daysInMonth = getMonthDays(d);
      const daily = 100 / daysInMonth;
      const slotsPerDay = 30;
      const currentDay = d.getDate();
      const currentHour = d.getHours();
      let slot = Math.floor((currentHour / 24) * slotsPerDay) + 1;
      if (slot > slotsPerDay) slot = slotsPerDay;
      const hourly = daily / slotsPerDay;
      const completedDays = currentDay - 1;
      const cumulative = (completedDays * daily) + (slot * hourly);
      return +cumulative.toFixed(3);
    }

    function iconForDepartment(name){
      const n = name.trim();
      if (n.includes("Ù…ÙØ±ÙˆØ´Ø§Øª")) return {emoji:"ğŸ›‹ï¸", tone:"orange"};
      if (n.includes("Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©")) return {emoji:"ğŸ¡", tone:""};
      if (n.includes("Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ©")) return {emoji:"ğŸ‘”", tone:"green"};
      if (n.includes("Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠØ©") || n.includes("Ø§Ù„Ø¨Ù†Ø§ØªÙŠ")) return {emoji:"ğŸ‘—", tone:"orange"};
      if (n.includes("Ø§Ù„ÙˆÙ„Ø§Ø¯ÙŠ")) return {emoji:"ğŸ‘¦", tone:"green"};
      if (n.includes("Ø§Ù„Ø¹Ø·ÙˆØ±") || n.includes("Ø³ÙŠÙÙˆØ±Ø§")) return {emoji:"ğŸ’„", tone:"orange"};
      if (n.includes("Ø§Ù„Ø£Ø­Ø°ÙŠØ©")) return {emoji:"ğŸ‘Ÿ", tone:"green"};
      if (n.includes("Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨") || n.includes("Ø£Ù„Ø¹Ø§Ø¨")) return {emoji:"ğŸ§¸", tone:"orange"};
      if (n.includes("Ø§Ù„Ø±ÙŠØ§Ø¶Ø©")) return {emoji:"ğŸ…", tone:"green"};
      if (n.includes("Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª")) return {emoji:"ğŸ·ï¸", tone:""};
      if (n.includes("Ø§Ù„Ù…ÙƒØªØ¨Ø©") || n.includes("Ø§Ù„Ø´Ù†Ø·")) return {emoji:"ğŸ‘œ", tone:""};
      if (n.includes("Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯") || n.includes("baby")) return {emoji:"ğŸ‘¶", tone:"orange"};
      return {emoji:"ğŸ“¦", tone:""};
    }

    function updateHeader() {
      const now = new Date();
      const options = { month: 'long', day: 'numeric', year: 'numeric' };
      const currentDate = new Intl.DateTimeFormat('ar', options).format(now);
      document.getElementById('currentDate').textContent = currentDate;
      document.getElementById('dailyBadge').textContent = "Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ " + fmt(getDailyTarget(now),5) + "%";
      document.getElementById('cumBadge').textContent   = "Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ Ø§Ù„Ø¢Ù† " + fmt(getCumulativeTarget(now),3) + "%";
    }

    function updatePerformance(){
      const target = getCumulativeTarget();
      document.querySelectorAll('.mall-card').forEach(card=>{
        const pctEl = card.querySelector('.mall-percentage');
        const statusEl = card.querySelector('.performance-status');
        if(!pctEl || !statusEl) return;
        const pct = parseFloat(pctEl.textContent);
        const diff = +(pct - target).toFixed(2);
        statusEl.textContent = `${Math.abs(diff)}% ${diff >= 0 ? 'Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù…Ø®Ø·Ø·' : 'Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ø®Ø·Ø·'}`;
        statusEl.className = `performance-status ${diff >= 0 ? 'above-target' : 'below-target'}`;
      });
    }

    function buildExtraCards(){
      const target = getCumulativeTarget();
      const centers = Array.from(document.querySelectorAll('.mall-card')).map(card=>({
        id: card.dataset.mall,
        name: card.querySelector('h2').textContent.trim(),
        pct: parseFloat(card.querySelector('.mall-percentage').textContent)
      })).filter(c=>!isNaN(c.pct));

      const sorted = centers.slice().sort((a,b)=>b.pct - a.pct);
      const best = sorted[0];
      const worst = sorted[sorted.length-1];
      const avg = +(centers.reduce((a,c)=>a+c.pct,0)/centers.length).toFixed(2);

      document.getElementById('extraCards').innerHTML = `
        <div class="stat-card">
          <div class="stat-icon">ğŸ†</div>
          <div>
            <div class="stat-title">Ø£ÙØ¶Ù„ Ù…Ø±ÙƒØ²</div>
            <div class="stat-value">${best.name}</div>
            <div class="stat-note">Ø­Ù‚Ù‚ ${fmt(best.pct)}%</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">â¬‡ï¸</div>
          <div>
            <div class="stat-title">Ø£Ù‚Ù„ Ù…Ø±ÙƒØ²</div>
            <div class="stat-value">${worst.name}</div>
            <div class="stat-note">Ø­Ù‚Ù‚ ${fmt(worst.pct)}%</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ“Š</div>
          <div>
            <div class="stat-title">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</div>
            <div class="stat-value">${fmt(avg)}%</div>
            <div class="stat-note">Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù Ø§Ù„Ø¢Ù† ${fmt(target)}%</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">â±ï¸</div>
          <div>
            <div class="stat-title">ØªØ±Ø§ÙƒÙ…ÙŠ Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©</div>
            <div class="stat-value">${fmt(target,3)}%</div>
            <div class="stat-note">ÙŠØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…</div>
          </div>
        </div>
      `;
    }

    function buildBestDeptCards(){
      const target = getCumulativeTarget();
      document.getElementById('bestDeptGrid').innerHTML = Object.entries(mallsData).map(([id,data])=>{
        const top3 = data.departments.slice().sort((a,b)=>b.percentage - a.percentage).slice(0,3);
        return `
          <div class="best-card">
            <div class="best-head">
              <div class="best-left">
                <div class="badge-square">ğŸ¢</div>
                <div>
                  <div style="font-size:.7rem;font-weight:700">${data.title}</div>
                  <div style="font-size:.58rem;color:rgba(227,232,255,.7)">Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
                </div>
              </div>
              <div class="chip">Top 3</div>
            </div>
            <div class="dept-list">
              ${top3.map((d,i)=>{
                const diff = +(d.percentage - target).toFixed(2);
                const sign = diff>=0?'+':'-';
                const {emoji,tone} = iconForDepartment(d.name);
                const toneClass = tone === "orange" ? "orange" : tone === "green" ? "green" : "";
                return `
                  <div class="dept-row">
                    <div class="dept-icon-3d ${toneClass}">${emoji}</div>
                    <div class="dept-name">${i+1}. ${d.name}</div>
                    <div class="chip">${fmt(d.percentage)}%</div>
                    <div class="chip">${sign}${fmt(Math.abs(diff))}%</div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }).join('');
    }

    function openModal(mallId){
      const mall = mallsData[mallId];
      if(!mall) return;
      document.getElementById('modalTitle').textContent = mall.title;
      const target = getCumulativeTarget();
      document.getElementById('departmentsContainer').innerHTML = mall.departments.map(dept=>{
        const p = +dept.percentage;
        const diff = +(p - target).toFixed(2);
        const cls = diff >= 0 ? 'above' : 'below';
        const {emoji,tone} = iconForDepartment(dept.name);
        const toneClass = tone === "orange" ? "orange" : tone === "green" ? "green" : "";
        return `
          <div class="department-card">
            <div class="dep-icon-holder ${toneClass}">${emoji}</div>
            <h3 style="font-size:.65rem">${dept.name}</h3>
            <div class="department-percentage">${fmt(p)}%</div>
            <div class="department-performance ${cls}">
              ${fmt(Math.abs(diff))}% ${diff >= 0 ? 'Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù…Ø®Ø·Ø·' : 'Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ø®Ø·Ø·'}
            </div>
          </div>
        `;
      }).join('');
      document.getElementById('modal').style.display = 'block';
    }

    function closeModal(){
      document.getElementById('modal').style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      updateHeader();
      updatePerformance();
      buildExtraCards();
      buildBestDeptCards();

      document.addEventListener('click', e=>{
        const card = e.target.closest('.mall-card');
        if(card) openModal(card.dataset.mall);
      });
      document.getElementById('closeModal').addEventListener('click', closeModal);
      document.getElementById('modal').addEventListener('click', e=>{ if(e.target.id==='modal') closeModal(); });

      setInterval(()=>{
        updateHeader();
        updatePerformance();
        buildExtraCards();
        buildBestDeptCards();
      }, 60000);
    });
  </script>
</body>
</html>
