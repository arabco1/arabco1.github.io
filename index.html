
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>مؤشرات أداء المراكز - لوحة تحكم</title>

  <!-- خط المراعي -->
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700;800&display=swap" rel="stylesheet">
  <!-- أيقونات -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg-main: #f3f4f6;
      --card-bg: rgba(255, 255, 255, 0.65);
      --text-dark: #111827;
      --accent: #2563eb;
      --success: #22c55e;
      --warn: #facc15;
      --danger: #ef4444;
      --font: 'Almarai', sans-serif;
      --shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    }

    * {box-sizing: border-box; margin: 0; padding: 0;}
    body {
      font-family: var(--font);
      background: linear-gradient(135deg, #dbeafe, #f9fafb);
      min-height: 100vh;
      color: var(--text-dark);
      padding: 1rem;
    }

    .container {
      max-width: 1200px;
      margin: auto;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: .5rem;
      text-align: center;
      margin-bottom: 2rem;
    }

    header h1 {
      font-size: 2rem;
      font-weight: 800;
      color: var(--accent);
    }

    .badges {
      display: flex;
      gap: .6rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .badge {
      background: var(--card-bg);
      padding: .5rem 1rem;
      border-radius: 999px;
      font-weight: 700;
      font-size: .9rem;
      box-shadow: var(--shadow);
    }

    /* summary cards */
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .summary-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 1.2rem;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      transition: .3s;
    }
    .summary-card:hover {transform: translateY(-4px);}
    .summary-card h3 {font-size: 1rem; opacity: .8;}
    .summary-card .val {font-size: 1.6rem; font-weight: 800; margin-top: .4rem; color: var(--accent);}

    /* malls grid */
    .malls {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(300px,1fr));
      gap: 1rem;
    }
    .mall-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: .3s;
    }
    .mall-card:hover {transform: translateY(-6px); background: rgba(255,255,255,.8);}
    .mall-info h3 {font-size: 1.1rem; font-weight: 700; margin-bottom: .4rem;}
    .mall-percentage {font-weight: 800; font-size: 1.4rem; color: var(--accent);}
    .progress {height: 8px; border-radius: 6px; background: #e5e7eb; overflow: hidden;}
    .progress span {display:block;height:100%}

    /* modal */
    .modal {position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:999;}
    .modal.show {display:flex;}
    .modal-panel {
      max-width: 1000px;
      width: 95%;
      background: #fff;
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 10px 40px rgba(0,0,0,.3);
      animation: scaleIn .3s ease;
    }
    @keyframes scaleIn {from{transform:scale(.9);opacity:0} to{transform:scale(1);opacity:1}}

    .modal-head {display:flex; justify-content:space-between; align-items:center;}
    .modal-head h2 {font-size: 1.4rem; font-weight: 800;}
    .modal-head button {
      border: none; background: var(--danger); color: #fff; padding: .5rem 1rem;
      border-radius: 8px; cursor: pointer; font-weight: 700;
    }
    .modal-body {display:grid; grid-template-columns: 300px 1fr; gap:1rem; margin-top:1rem;}
    @media(max-width:800px){.modal-body{grid-template-columns:1fr}}

    .dept-card {
      background: #f9fafb;
      padding: .6rem .8rem;
      border-radius: 10px;
      margin-bottom: .5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
    }
    .dept-card i {color: var(--accent); margin-left:.5rem;}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>مؤشرات أداء المراكز التجارية</h1>
      <div class="badges">
        <div id="targetBadge" class="badge">هدف اليوم: --%</div>
        <div id="monthTarget" class="badge">هدف الشهر: 100%</div>
        <div id="currentDate" class="badge">--</div>
      </div>
    </header>

    <div class="summary">
      <div class="summary-card"><h3>المعدل العام</h3><div class="val" id="avgVal">--%</div></div>
      <div class="summary-card"><h3>أعلى مركز</h3><div class="val" id="topMall">--</div></div>
      <div class="summary-card"><h3>أقل مركز</h3><div class="val" id="lowMall">--</div></div>
    </div>

    <section class="malls" id="mallsGrid"></section>
  </div>

  <!-- modal -->
  <div id="modal" class="modal">
    <div class="modal-panel">
      <div class="modal-head">
        <h2 id="modalTitle"></h2>
        <button onclick="closeModal()">إغلاق</button>
      </div>
      <div class="modal-body">
        <div id="departmentsContainer"></div>
        <div><canvas id="deptChart"></canvas></div>
      </div>
    </div>
  </div>

<script>
const mallsData = {
  ansar:{title:"الأنصار مول",percentage:18.38,departments:[
     { name: "المفروشات", percentage: "12.84", icon: "fa-couch" },
     { name: "المنزلية", percentage: "12.55", icon: "fa-home" },
     { name: "الملابس الرجالية", percentage: "24.04", icon: "fa-shirt" },
     { name: "الملابس النسائية", percentage: "24.63", icon: "fa-person-dress" },
     { name: "الملابس الولادي", percentage: "20.36", icon: "fa-child" },
     { name: "العطور", percentage: "20.66", icon: "fa-spray-can" },
     { name: "الأحذية", percentage: "19.24", icon: "fa-shoe-prints" },
     { name: "الألعاب", percentage: "38.55", icon: "fa-gamepad" },
     { name: "الرياضة والجاكت", percentage: "25.47", icon: "fa-futbol" },
     { name: "التخفيضات", percentage: "11.29", icon: "fa-tags" },
     { name: "سيفورا", percentage: "17.89", icon: "fa-wand-magic-sparkles" },
     { name: "المكتبة والشنط", percentage: "25.11", icon: "fa-pen" }
  ]},
  fourpark:{title:"فور بارك",percentage:15.73,departments:[
    {name:"المفروشات",percentage:16.26,icon:"fa-couch"},
    {name:"المنزلية",percentage:11.71,icon:"fa-house"}
  ]},
  abyat:{title:"أبيات عسير",percentage:14.75,departments:[
    {name:"المفروشات",percentage:13.76,icon:"fa-couch"},
    {name:"الملابس الرجالية",percentage:19.98,icon:"fa-shirt"}
  ]},
  arabplaza:{title:"العرب بلازا",percentage:15.05,departments:[
    {name:"المفروشات",percentage:18.88,icon:"fa-couch"},
    {name:"الألعاب",percentage:11.86,icon:"fa-gamepad"}
  ]}
};

function formatDateArabic(d){return new Intl.DateTimeFormat('ar-EG',{year:'numeric',month:'long',day:'numeric'}).format(d);}
function calculateTarget(){return (3.33 * new Date().getDate()).toFixed(2);}
const target=calculateTarget();
document.getElementById('targetBadge').textContent=`هدف اليوم: ${target}%`;
document.getElementById('currentDate').textContent=formatDateArabic(new Date());

function getColor(p){
  if(p>=target) return "var(--success)";
  if(p>=target/2) return "var(--warn)";
  return "var(--danger)";
}

const mallsGrid=document.getElementById('mallsGrid');
function renderMalls(){
  mallsGrid.innerHTML="";
  const arr=Object.values(mallsData);
  const avg=(arr.reduce((a,c)=>a+c.percentage,0)/arr.length).toFixed(2);
  document.getElementById('avgVal').textContent=avg+"%";
  const top=arr.reduce((a,c)=>c.percentage>a.percentage?c:a);
  const low=arr.reduce((a,c)=>c.percentage<a.percentage?c:a);
  document.getElementById('topMall').textContent=top.title;
  document.getElementById('lowMall').textContent=low.title;

  arr.sort((a,b)=>b.percentage-a.percentage).forEach(m=>{
    const card=document.createElement('div');
    card.className="mall-card";
    card.onclick=()=>openModal(m);
    const info=document.createElement('div');
    info.className="mall-info";
    info.innerHTML=`<h3>${m.title}</h3><div class="progress"><span style="width:${m.percentage}%;background:${getColor(m.percentage)}"></span></div>`;
    const percentage=document.createElement('div');
    percentage.className="mall-percentage";
    percentage.textContent=m.percentage+"%";
    card.appendChild(info);
    card.appendChild(percentage);
    mallsGrid.appendChild(card);
  });
}
renderMalls();

// modal
let chart=null;
function openModal(mall){
  document.getElementById('modalTitle').textContent=mall.title;
  const cont=document.getElementById('departmentsContainer');
  cont.innerHTML="";
  mall.departments.forEach(d=>{
    const el=document.createElement('div');
    el.className="dept-card";
    el.innerHTML=`<span><i class="fa ${d.icon}"></i> ${d.name}</span><span>${d.percentage}%</span>`;
    cont.appendChild(el);
  });
  const ctx=document.getElementById('deptChart');
  if(chart){chart.destroy();}
  chart=new Chart(ctx,{type:'bar',data:{labels:mall.departments.map(d=>d.name),
    datasets:[{data:mall.departments.map(d=>d.percentage),backgroundColor:["#2563eb","#10b981","#f59e0b","#ef4444","#8b5cf6"]}]},
    options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}});
  document.getElementById('modal').classList.add('show');
}
function closeModal(){document.getElementById('modal').classList.remove('show');}
</script>
</body>
</html>
